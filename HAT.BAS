REM Mexican hat for MachiKania

USETIMER 100
USEVAR DR#,SX,SY,COL
USEGRAPHIC
H=SYSTEM(23):W=SYSTEM(22)
DIM D(H-1)

REM カラーパレット設定（手動設定）
GPALETTE  1,   0,   0, 255:REM BLUE
GPALETTE  2,   0, 255,   0:REM GREEN
GPALETTE  3,   0, 161, 233:REM CYAN
GPALETTE  4, 255,   0,   0:REM RED
GPALETTE  5, 228,   0, 127:REM MAGENTA
GPALETTE  6, 255, 255,   0:REM YELLOW
GPALETTE  7, 128, 128, 128:REM GRAY
GPALETTE  8, 165,  42,  42:REM BROWN
GPALETTE  9, 255, 165,   0:REM ORANGE
GPALETTE 10, 255, 255, 255:REM WHITE

FOR I=0 TO W : REM width
  D(I)=400
NEXT

DR# = PI# / 180

PRINT "Press FIRE!"
PRINT "Start drawing HAT"
WHILE KEYS(32)=0:WEND

TIMER 0

FOR Y=-180 TO 180 STEP 6
  FOR X=-180 TO 180 STEP 4
    R# = DR# * SQRT#(FLOAT#(X*X + Y*Y))
    Z = INT(100 * COS#(R#) - 30 * COS#(3 * R#))
    SX = W/2 + INT(FLOAT#(X) / 3 - FLOAT#(Y) / 6)
    SY = H/2 - INT(FLOAT#(Y) / 6 + FLOAT#(Z) / 4)

    IF SX<0 OR SX>W THEN GOTO LB250
    IF D(SX) <= SY THEN GOTO LB250

    COL = INT((FLOAT#(Z) + 100) * 0.035) + 1
    IF COL <= 0 THEN GOTO JMP1

    PSET SX, SY, COL
    D(SX) = SY
LABEL LB250
  NEXT
LABEL JMP1
NEXT

T = TIMER()

WHILE KEYS(32)=0:WEND

GPALETTE 7,255,255,255
COLOR 7
PRINT "Processing time:";
PRINT T * 100;"usec"
END